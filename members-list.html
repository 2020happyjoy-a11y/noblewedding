<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 리스트 - 관리자</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 30px; }
        h1 { text-align: center; }
        .container { max-width: 980px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .filters { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        select, button, input { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; }
        .member-box { border: 1px solid #ddd; padding: 12px; margin-bottom: 10px; border-radius: 6px; cursor: pointer; background: #fafafa; }
        .member-box:hover { background: #eef3ff; }
    </style>
</head>
<body>
<h1>회원 리스트</h1>
<div class="container">
    <div class="filters">
        <!-- 성별 필터 -->
        <select id="genderFilter">
            <option value="">성별 전체</option>
            <option value="남성">남성</option>
            <option value="여성">여성</option>
        </select>
        <button onclick="applyFilters()">필터 적용</button>
    </div>
    <div id="memberList"><p>불러오는 중...</p></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase 설정
const firebaseConfig = {
  apiKey: "AIzaSyAfWEFCYDB9UQ-NktaR-CkjQGXOxPc6lMY",
  authDomain: "noble-wedding.firebaseapp.com",
  projectId: "noble-wedding",
  storageBucket: "noble-wedding.firebasestorage.app",
  messagingSenderId: "242816725640",
  appId: "1:242816725640:web:abc5dcfce08367789a653d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 회원 불러오기
async function loadMembers(filters={}) {
    const listBox = document.getElementById("memberList");
    listBox.innerHTML = "<p>불러오는 중...</p>";
    try {
        let col = collection(db, "members");
        let q = col;

        // 성별 필터
        if(filters.gender) q = query(col, where("gender", "==", filters.gender));

        const snapshot = await getDocs(q);
        if(snapshot.empty){ listBox.innerHTML="<p>회원이 없습니다.</p>"; return; }

        listBox.innerHTML="";
        snapshot.forEach(doc => {
            const data = doc.data();
            const box = document.createElement("div");
            box.className="member-box";
            box.onclick = ()=>{ window.location.href=`members.html?id=${doc.id}`; };
            box.innerHTML=`
                <strong>${data.name || ""}</strong> (${data.gender || "?"})<br>
                생년월일: ${data.birth || "-"}<br>
                직업: ${data.job || "-"}<br>
                거주지: ${data.address || "-"}<br>
                연락처: ${data.phone || "-"}
            `;
            listBox.appendChild(box);
        });
    } catch(err){
        console.error(err);
        listBox.innerHTML="<p style='color:red;'>불러오는 중 오류 발생</p>";
    }
}

// 필터 적용
function applyFilters(){
    const gender = document.getElementById("genderFilter").value;
    loadMembers({gender});
}

// 초기 로딩
loadMembers();
</script>
</body>
</html>
