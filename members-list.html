<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>회원 리스트 - 관리자</title>
<style>
  body { font-family: "Noto Sans KR", system-ui, sans-serif; background:#f6f6f8; margin:0; padding:20px; }
  .wrap { max-width: 900px; margin: auto; }
  h1 { text-align:center; margin-bottom:20px; }
  .filters { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
  select, input, button { padding:8px 12px; border-radius:6px; border:1px solid #ccc; }
  #memberList { display:flex; flex-direction:column; gap:10px; }
  .member-box { padding:12px; background:#fff; border-radius:6px; border:1px solid #ddd; cursor:pointer; }
  .member-box:hover { background:#eef3ff; }
</style>
</head>
<body>
<div class="wrap">
  <h1>회원 리스트</h1>
  <div class="filters">
    <select id="genderFilter">
      <option value="">성별 전체</option>
      <option value="남성">남성</option>
      <option value="여성">여성</option>
    </select>
    <select id="ageFilter">
      <option value="">나이 전체</option>
      <option value="20">20대</option>
      <option value="30">30대</option>
      <option value="40">40대</option>
      <option value="50">50대</option>
    </select>
    <select id="heightFilter">
      <option value="">키 전체</option>
      <option value="160">160cm 이상</option>
      <option value="170">170cm 이상</option>
      <option value="180">180cm 이상</option>
    </select>
    <input type="text" id="regionFilter" placeholder="지역 입력 (예: 서울)">
    <button onclick="applyFilters()">필터 적용</button>
  </div>
  <div id="memberList">
    <p>불러오는 중...</p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfWEFCYDB9UQ-NktaR-CkjQGXOxPc6lMY",
  authDomain: "noble-wedding.firebaseapp.com",
  projectId: "noble-wedding",
  storageBucket: "noble-wedding.firebasestorage.app",
  messagingSenderId: "242816725640",
  appId: "1:242816725640:web:abc5dcfce08367789a653d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 회원 목록 불러오기
async function loadMembers(filters={}) {
  const listBox = document.getElementById("memberList");
  listBox.innerHTML = "<p>불러오는 중...</p>";

  try {
    let q = collection(db, "members");

    if(filters.gender) q = query(q, where("gender","==",filters.gender));
    if(filters.age) {
      const min = Number(filters.age), max = min + 9;
      q = query(q, where("age",">=",min), where("age","<=",max));
    }
    if(filters.height) q = query(q, where("height",">=",Number(filters.height)));
    if(filters.region) q = query(q, where("region","==",filters.region));

    const snapshot = await getDocs(q);

    if(snapshot.empty){ listBox.innerHTML="<p>조건에 맞는 회원이 없습니다.</p>"; return; }

    listBox.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const box = document.createElement("div");
      box.className = "member-box";
      box.onclick = ()=>window.location.href=`members.html?id=${doc.id}`;
      box.innerHTML = `
        <strong>${data.name}</strong><br>
        성별: ${data.gender||"?"}<br>
        나이: ${data.age||"?"}세<br>
        키: ${data.height||"?"}cm<br>
        지역: ${data.region||"?"}<br>
        소개: ${data.intro||""}
      `;
      listBox.appendChild(box);
    });

  } catch(err) {
    console.error(err);
    listBox.innerHTML="<p style='color:red;'>데이터를 불러오는 중 오류 발생</p>";
  }
}

function applyFilters() {
  loadMembers({
    gender: document.getElementById("genderFilter").value,
    age: document.getElementById("ageFilter").value,
    height: document.getElementById("heightFilter").value,
    region: document.getElementById("regionFilter").value.trim()
  });
}

// 최초 로딩
loadMembers();
</script>
</body>
</html>
