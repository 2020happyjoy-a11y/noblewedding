<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ë¦¬ìŠ¤íŠ¸ - ê´€ë¦¬ì</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 30px;
        }

        h1 {
            text-align: center;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .filters {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        select, button, input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .member-box {
            border: 1px solid #ddd;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            cursor: pointer;
            background: #fafafa;
        }

        .member-box:hover {
            background: #eef3ff;
        }
    </style>
</head>
<body>

<h1>íšŒì› ë¦¬ìŠ¤íŠ¸</h1>

<div class="container">

    <!-- ğŸ”¹ í•„í„° ì˜ì—­ -->
    <div class="filters">
        <!-- ì„±ë³„ -->
        <select id="genderFilter">
            <option value="">ì„±ë³„ ì „ì²´</option>
            <option value="ë‚¨ì„±">ë‚¨ì„±</option>
            <option value="ì—¬ì„±">ì—¬ì„±</option>
        </select>

        <!-- ë‚˜ì´ -->
        <select id="ageFilter">
            <option value="">ë‚˜ì´ ì „ì²´</option>
            <option value="20">20ëŒ€</option>
            <option value="30">30ëŒ€</option>
            <option value="40">40ëŒ€</option>
            <option value="50">50ëŒ€</option>
        </select>

        <!-- í‚¤ -->
        <select id="heightFilter">
            <option value="">í‚¤ ì „ì²´</option>
            <option value="160">160cm ì´ìƒ</option>
            <option value="170">170cm ì´ìƒ</option>
            <option value="180">180cm ì´ìƒ</option>
        </select>

        <!-- ì§€ì—­ -->
        <input id="regionFilter" type="text" placeholder="ì§€ì—­ ì…ë ¥ (ì˜ˆ: ì„œìš¸)" />

        <!-- í•„í„° ì ìš© ë²„íŠ¼ -->
        <button onclick="applyFilters()">í•„í„° ì ìš©</button>
    </div>

    <!-- ğŸ”¹ íšŒì› ë¦¬ìŠ¤íŠ¸ ë°•ìŠ¤ -->
    <div id="memberList">
        <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
    import { 
        initializeApp 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

    import { 
        getFirestore, collection, getDocs, query, where 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ğŸ”¹ Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyAfWEFCYDB9UQ-NktaR-CkjQGXOxPc6lMY",
      authDomain: "noble-wedding.firebaseapp.com",
      projectId: "noble-wedding",
      storageBucket: "noble-wedding.firebasestorage.app",
      messagingSenderId: "242816725640",
      appId: "1:242816725640:web:abc5dcfce08367789a653d"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);


    // ğŸ”¹ íšŒì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
    async function loadMembers(filters = {}) {
        const listBox = document.getElementById("memberList");
        listBox.innerHTML = "<p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";

        try {
            let q = collection(db, "members");

            // ğŸ”¸ ì„±ë³„ í•„í„°
            if (filters.gender) {
                q = query(q, where("gender", "==", filters.gender));
            }

            // ğŸ”¸ ë‚˜ì´ í•„í„° (20/30/40/50ëŒ€ êµ¬ê°„)
            if (filters.age) {
                const minAge = Number(filters.age);
                const maxAge = minAge + 9;
                q = query(q, where("age", ">=", minAge), where("age", "<=", maxAge));
            }

            // ğŸ”¸ í‚¤ í•„í„° (160 ì´ìƒ / 170 ì´ìƒ / 180 ì´ìƒ)
            if (filters.height) {
                q = query(q, where("height", ">=", Number(filters.height)));
            }

            // ğŸ”¸ ì§€ì—­ í•„í„° (ë¬¸ì í¬í•¨ ê²€ìƒ‰ X / ì™„ë²½ ì¼ì¹˜ë§Œ ê°€ëŠ¥)
            if (filters.region) {
                q = query(q, where("region", "==", filters.region));
            }

            const snapshot = await getDocs(q);

            if (snapshot.empty) {
                listBox.innerHTML = "<p>ì¡°ê±´ì— ë§ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            listBox.innerHTML = "";

            snapshot.forEach(doc => {
                const data = doc.data();

                const box = document.createElement("div");
                box.className = "member-box";

                // í´ë¦­ ì‹œ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™
                box.onclick = () => {
                    window.location.href = `members.html?id=${doc.id}`;
                };

                box.innerHTML = `
                    <strong>${data.name}</strong><br>
                    ì„±ë³„: ${data.gender || "?"}<br>
                    ë‚˜ì´: ${data.age || "?"}ì„¸<br>
                    í‚¤: ${data.height || "?"}cm<br>
                    ì§€ì—­: ${data.region || "?"}<br>
                    ì†Œê°œ: ${data.intro || ""}
                `;

                listBox.appendChild(box);
            });

        } catch (err) {
            console.error(err);
            listBox.innerHTML = "<p style='color:red;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ</p>";
        }
    }

    // ğŸ”¹ í•„í„° ì ìš© ë²„íŠ¼
    function applyFilters() {
        const gender = document.getElementById("genderFilter").value;
        const age = document.getElementById("ageFilter").value;
        const height = document.getElementById("heightFilter").value;
        const region = document.getElementById("regionFilter").value.trim();

        loadMembers({
            gender,
            age,
            height,
            region
        });
    }

    // ğŸ”¹ ì²« ë¡œë”© ì‹œ ì „ì²´ íšŒì› ë³´ì—¬ì£¼ê¸°
    loadMembers();

</script>

</body>
</html>

