<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>회원 상세 보기 - 관리자</title>
  <style>
    body{font-family:system-ui,"Noto Sans KR",sans-serif;background:#f6f6f8;margin:0;padding:20px}
    .wrap{max-width:900px;margin:0 auto}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 10px 20px rgba(20,20,30,0.06)}
    .row{display:flex;gap:12px;align-items:center;margin-bottom:8px}
    .label{width:120px;color:#666;font-weight:600}
    .thumb{width:160px;height:160px;border-radius:8px;background:#fafafa;border:1px solid #eee;display:flex;align-items:center;justify-content:center}
    .actions{margin-top:12px;display:flex;gap:8px}
    button{padding:8px 12px;border-radius:8px;border:0;background:#2b6cff;color:#fff;cursor:pointer}
    a.download-link{display:block;margin-bottom:4px;color:#2b6cff;text-decoration:none;font-size:0.95rem}
    a.download-link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>회원 상세</h1>
    <div id="content" class="card">
      <p>데이터를 불러오는 중...</p>
    </div>
    <div style="margin-top:12px">
      <button onclick="history.back()">목록으로</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfWEFCYDB9UQ-NktaR-CkjQGXOxPc6lMY",
      authDomain: "noble-wedding.firebaseapp.com",
      projectId: "noble-wedding",
      storageBucket: "noble-wedding.firebasestorage.app",
      messagingSenderId: "242816725640",
      appId: "1:242816725640:web:abc5dcfce08367789a653d",
      measurementId: "G-67MYW2RRSJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    function escapeHtml(s){ 
      if(s===undefined||s===null) return ''; 
      return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); 
    }

    async function loadMember(){
      const el = document.getElementById('content');
      el.innerHTML = '<p>불러오는 중...</p>';
      if(!id){ el.innerHTML = '<p>잘못된 접근: ID 없음</p>'; return; }

      try{
        const snap = await getDoc(doc(db,'members', id));
        if(!snap.exists()){ el.innerHTML = '<p>회원 정보를 찾을 수 없습니다.</p>'; return; }

        const m = snap.data();

        // 사진 배열 미리보기
        const photosHtml = (m.photos && m.photos.length > 0) 
          ? `<img src="${m.photos[0]}" style="width:100%;height:100%;object-fit:cover;border-radius:6px">` 
          : '<span>사진 없음</span>';

        // 업로드 서류 다운로드 링크
        function buildFileLinks(label, files){
          if(!files || files.length===0) return `<div>-</div>`;
          return files.map(url=>`<a href="${url}" target="_blank" class="download-link">${label}</a>`).join('');
        }

        el.innerHTML = `
          <div style="display:flex;gap:16px;align-items:flex-start">
            <div style="flex:0 0 180px">
              <div class="thumb">${photosHtml}</div>
            </div>
            <div style="flex:1">
              <div class="row"><div class="label">이름</div><div>${escapeHtml(m.name)}</div></div>
              <div class="row"><div class="label">생년월일</div><div>${escapeHtml(m.birth || '')}</div></div>
              <div class="row"><div class="label">성별</div><div>${escapeHtml(m.gender || '')}</div></div>
              <div class="row"><div class="label">직업</div><div>${escapeHtml(m.job || '')}</div></div>
              <div class="row"><div class="label">거주지</div><div>${escapeHtml(m.address || '')}</div></div>
              <div class="row"><div class="label">휴대폰</div><div>${escapeHtml(m.phone || '')}</div></div>
              <div style="margin-top:12px"><div class="label">자기소개</div><div>${escapeHtml(m.intro || '')}</div></div>

              <div style="margin-top:12px"><div class="label">가족관계증명서</div>${buildFileLinks('가족관계증명서', [m.familyDoc])}</div>
              <div style="margin-top:8px"><div class="label">혼인관계증명서</div>${buildFileLinks('혼인관계증명서', [m.marriageDoc])}</div>
              <div style="margin-top:8px"><div class="label">졸업증명서</div>${buildFileLinks('졸업증명서', m.gradDocs)}</div>
              <div style="margin-top:8px"><div class="label">소득 서류</div>${buildFileLinks('소득 서류', m.incomeDocs)}</div>
              <div style="margin-top:8px"><div class="label">부동산 서류</div>${buildFileLinks('부동산 서류', m.propDocs)}</div>
              <div style="margin-top:8px"><div class="label">차량 서류</div>${buildFileLinks('차량 서류', m.carDocs)}</div>
              <div style="margin-top:8px"><div class="label">기타 서류</div>${buildFileLinks('기타 서류', m.otherDocs)}</div>

              <div class="actions">
                <button onclick="window.location.href='mailto:?subject=회원 문의'">연락</button>
                <button onclick="window.open(window.location.href)">새창열기</button>
              </div>
            </div>
          </div>
        `;
      }catch(e){
        console.error(e);
        el.innerHTML = '<p>오류가 발생했습니다.</p>';
      }
    }

    loadMember();
  </script>
</body>
</html>
